<!doctype html>
<html>
    <head>
        <title></title>

        <script src="../libs/jquery.js"></script>

        <script src="../libs/signals.js"></script>

        <script src="../libs/cryptojs/rollups/md5.js"></script>
        <script src="../libs/cryptojs/rollups/sha1.js"></script>
        <script src="../libs/cryptojs/components/core.js"></script>
        <script src="../libs/cryptojs/components/enc-base64.js"></script>


        <script src="../src/jslix.js"></script>
        <script src="../src/jslix.stanzas.js"></script>
        <script src="../src/jslix.bind.js"></script>
        <script src="../src/jslix.session.js"></script>
        <script src="../src/jslix.roster.js"></script>
        <script src="../src/jslix.connection.js"></script>
        <script src="../src/jslix.connection.transports.bosh.js"></script>
        <script src="../src/jslix.dispatcher.js"></script>
        <script src="../src/jslix.jid.js"></script>
        <script src="../src/jslix.version.js"></script>
        <script src="../src/jslix.sasl.js"></script>
        <script src="../src/jslix.sasl.mechanisms.plain.js"></script>
        <script src="../src/jslix.sasl.mechanisms.digest_md5.js"></script>
        <script src="../src/jslix.disco.js"></script>
        <script src="../src/jslix.caps.js"></script>
        <script src="../src/jslix.BaseClient.js"></script>
        <script src="../src/jslix.Client.js"></script>

        <script>
            function doLogin(oForm) {
                document.getElementById('err').innerHTML = '';
                    window.debug = true;
                    var options = {
                        http_base: oForm.http_base.value,
                        jid: oForm.jid.value,
                        password: oForm.password.value,
                        register: oForm.register.checked
                    },
                    client = new jslix.Client(options);
                    client.connect().done(function(){
                        var disco_plugin = client.registerPlugin(jslix.Disco);
                        var plugins_options = {
                                'disco_plugin': disco_plugin,
                                'storage': sessionStorage,
                                'name': 'jslix',
                                'version': 'beta'
                            };
                        disco_plugin.registerIdentity('client', 'web', 'jslix');
                        client.registerPlugin(jslix.Version, plugins_options).init();
                        disco_plugin.init();
                        client.registerPlugin(jslix.Caps, plugins_options);
                        client.send(jslix.stanzas.PresenceStanza.create());
                    });
                    window.client = client;
                return false;
            }
        </script>

    </head>
    <body>
        <div id="err"></div>

        <div id="login_pane">
            <form name="loginForm" onSubmit="return doLogin(this);" action="" method="post">
                <table>
                    <tr>
                        <th><label for="http_base">HTTP Base</label></th><td>
                        <input type="text" name="http_base" id="http_base" tabindex="1" value="/bosh/"/>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="jid">JID</label></th><td>
                        <input type="text" name="jid" id="jid" tabindex="2" value="user@server.local"/>
                        </td>
                    </tr>
                    <tr>
                        <th><label for="password">Password</label></th><td>
                        <input type="password" name="password" id="password" tabindex="3" value="ghjcnjgfhjkm"/>
                        </td>
                    </tr>
                    <tr>
                        <th></th><td>
                        <input type="checkbox" name="register" id="register_checkbox" />
                        <label for="register_checkbox">Register new account</label></td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td><td>
                        <input type="submit" value="Login" tabindex="4">
                        </td>
                    </tr>
                </table>
            </form>
        </div>

    </body>
</html>
